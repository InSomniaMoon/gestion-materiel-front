#!/bin/sh
set -e

# Ensure Node/npx are available in non-interactive shells (e.g., IDE Git env)
if [ -s "$HOME/.nvm/nvm.sh" ]; then . "$HOME/.nvm/nvm.sh"; fi
if [ -s "/opt/homebrew/opt/nvm/nvm.sh" ]; then . "/opt/homebrew/opt/nvm/nvm.sh"; fi

# Collect staged files (NUL-delimited)
FILES=$(git diff --cached --name-only -z --diff-filter=ACMR)
if [ -n "$FILES" ]; then
	# Prettify only known text files; Prettier will skip unknown with --ignore-unknown
	printf "%s" "$FILES" \
		| xargs -0 npx --yes prettier --write --ignore-unknown --loglevel warn
	git update-index --again
fi

exit 0
