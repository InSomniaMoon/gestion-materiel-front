<matos-table [status]="itemsResource.status()">
  <div header class="header">
    <div class="flex">
      <p-select
        dropdownIcon="pi pi-filter"
        loadingIcon="pi pi-spin pi-spinner"
        [loading]="categoriesResource.isLoading()"
        [checkmark]="true"
        scrollHeight="250px"
        optionLabel="name"
        optionValue="id"
        [options]="categories()"
        [fluid]="true"
        [(ngModel)]="categoryId"
        (ngModelChange)="onCategoryChange()" />
      <app-search-bar (queryChange)="searchQuery.set($event)" />
    </div>

    @if (selectedItemsCount() > 0) {
      <button pButton (click)="viewTakenItems()">
        <i class="pi pi-eye" pButtonIcon></i>
        <span class="no-show-mobile" pButtonLabel
          >{{ selectedItemsCount() }} objet{{
            selectedItemsCount() > 1 ? 's' : ''
          }}</span
        >
      </button>
    }
  </div>
  <p-table
    [value]="items()"
    stripedRows
    [sortField]="orderBy()"
    [sortOrder]="sortBy()"
    (onSort)="orderBy.set($event.field); sortBy.set($event.order)">
    <ng-template #header>
      <tr>
        <th></th>
        <th pSortableColumn="items.name">
          Nom<p-sortIcon field="items.name" />
        </th>
        <th pSortableColumn="category_id">
          Categorie <p-sortIcon field="category_id" />
        </th>
        <th>Restant</th>
      </tr>
    </ng-template>
    <ng-template #body let-product>
      <tr>
        <td style="width: fit-content">
          <p-check-box
            [binary]="true"
            [ngModel]="product.selected"
            (onChange)="
              $event.originalEvent?.stopPropagation();
              $event.originalEvent?.preventDefault();
              selectUnselectItem(product)
            " />
          <!-- (ngModelChange)="selectUnselectItem(product)" -->
        </td>
        <td>{{ product.name }}</td>
        <td style="text-wrap: nowrap">{{ product.category.name }}</td>
        <td>{{ product.rest }}</td>
      </tr>
    </ng-template>
  </p-table>
  <app-paginator
    [(page)]="page"
    [(size)]="size"
    [totalRecords]="itemsResource.value()?.total ?? 0"
    [options]="options" />
</matos-table>
<div class="footer">
  <p-button
    label="Précédent"
    icon="pi pi-arrow-left"
    iconPos="left"
    (onClick)="previousStep.emit()" />
  <p-button
    label="Suivant"
    icon="pi pi-arrow-right"
    iconPos="right"
    [disabled]="formGroup().invalid"
    (onClick)="nextStep.emit()" />
</div>
