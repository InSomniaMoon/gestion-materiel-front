<matos-table [status]="itemsResource.status()">
  <div header class="header">
    <div class="flex">
      <p-select
        dropdownIcon="pi pi-filter"
        loadingIcon="pi pi-spin pi-spinner"
        [loading]="categoriesResource.isLoading()"
        [checkmark]="true"
        scrollHeight="250px"
        optionLabel="name"
        optionValue="id"
        [options]="categories()"
        [fluid]="true"
        [(ngModel)]="categoryId"
        (ngModelChange)="onCategoryChange()" />
      <app-search-bar (queryChange)="searchQuery.set($event)" />
    </div>

    @if (formGroup().value.length > 0) {
      <button pButton (click)="viewTakenItems()">
        <i class="pi pi-eye" pButtonIcon></i>
        <span class="no-show-mobile" pButtonLabel
          >{{ formGroup().value.length }} objet{{
            formGroup().value.length > 1 ? 's' : ''
          }}</span
        >
      </button>
    }
  </div>
  <p-table [value]="items()">
    <ng-template #header>
      <tr>
        <th></th>
        <th>Nom</th>
        <th>Catégorie</th>
      </tr>
    </ng-template>
    <ng-template #body let-product>
      <tr>
        <td style="width: fit-content">
          <p-check-box
            [binary]="true"
            [ngModel]="product.selected"
            (ngModelChange)="toggleProductSelection(product)" />
        </td>
        <td>{{ product.name }}</td>
        <td style="text-wrap: nowrap">{{ product.category.name }}</td>
      </tr>
    </ng-template>
  </p-table>
  <app-paginator
    [(page)]="page"
    [(size)]="size"
    [totalRecords]="itemsResource.value()?.total ?? 0" />
</matos-table>
<div class="footer">
  <p-button
    label="Précédent"
    icon="pi pi-arrow-left"
    iconPos="left"
    (onClick)="previousStep.emit()" />
  <p-button
    label="Suivant"
    icon="pi pi-arrow-right"
    iconPos="right"
    [disabled]="formGroup().invalid"
    (onClick)="nextStep.emit()" />
</div>
