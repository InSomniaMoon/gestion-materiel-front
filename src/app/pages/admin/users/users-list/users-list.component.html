<matos-table [status]="usersResource.status()">
  <div header class="header">
    <div class="flex">
      <h1>Utilisateurs</h1>
      <app-search-bar (queryChange)="searchQuery.set($event)" />
    </div>
    <p-button icon="pi pi-plus" label="Ajouter" (onClick)="openAddUser()" />
  </div>
  <p-table
    [value]="users()"
    [sortField]="orderBy()"
    [sortOrder]="sortBy()"
    (onSort)="orderBy.set($event.field); sortBy.set($event.order)">
    <ng-template #header>
      <tr>
        <th pSortableColumn="lastname">Nom <p-sortIcon field="lastname" /></th>
        <th pSortableColumn="firstname">
          PrÃ©nom <p-sortIcon field="firstname" />
        </th>
        <th>Structures</th>
        <th pSortableColumn="email">Email <p-sortIcon field="email" /></th>
        <th pSortableColumn="role">RÃ´le <p-sortIcon field="role" /></th>
        <th></th>
      </tr>
    </ng-template>

    <ng-template #body let-user>
      <tr>
        <td>{{ user.lastname }}</td>
        <td>{{ user.firstname }}</td>
        <td>
          <div class="flex">
            @for (structure of user.user_structures; track $index) {
              <div
                [tp]="structure.name"
                [style]="
                  `width: 40px; height: 28px; background-color: ${structure.color}; border-radius: 4px;`
                "></div>
            }
          </div>
        </td>
        <td>{{ user.email }}</td>
        <td>
          {{
            user.user_structures[0]?.pivot.role == 'admin'
              ? 'Administrateur'
              : 'Utilisateur'
          }}
        </td>
        <td>
          <!-- Actions can be added here -->
        </td>
      </tr>
    </ng-template>
  </p-table>
  <app-paginator
    [(page)]="page"
    [(size)]="size"
    [totalRecords]="usersResource.value()?.total ?? 0"
    [options]="options" />
</matos-table>
